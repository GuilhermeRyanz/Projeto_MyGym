import{a as B,b as k}from"./chunk-HDD2KNVB.js";import{a as ee}from"./chunk-CNUYDMNB.js";import{b as K,g as W,h as X,j as Y,k as Z}from"./chunk-T3ODEV2J.js";import{B as L,E as J,a as T,d as U,f as N,h as G,k as A,l as Q,p as z,s as H,v as R,z as $}from"./chunk-DCGZQB77.js";import{a as V,b as j}from"./chunk-PR2HLA7M.js";import{$b as r,Cb as C,Db as _,Eb as o,Fb as n,Gb as v,Kb as x,Nb as w,Ub as b,Vb as y,Wb as I,Wc as O,Ya as s,Za as d,ac as p,bc as F,cd as P,ic as q,ja as u,lc as D,mc as E,ob as g,oc as S,ra as f,sa as h,ub as c,zb as M}from"./chunk-KNMBK3NL.js";var te=["chatMessages"],ie=(i,m)=>m.id,ae=(i,m)=>({"user-message":i,"ia-message":m});function ne(i,m){if(i&1&&(o(0,"div",4)(1,"div",10)(2,"span",11),r(3),n(),o(4,"span",12),r(5),E(6,"date"),n()()()),i&2){let t=m.$implicit;c("ngClass",D(6,ae,t.isUser,!t.isUser)),s(3),p(t.text),s(2),p(S(6,3,t.time,"shortTime"))}}function oe(i,m){i&1&&(o(0,"div",5)(1,"p"),r(2,"Fa\xE7a uma pergunta para come\xE7ar a conversar com a IA!"),n()())}var be=(()=>{class i{formBuilder;httpMethods;chatForm;messages=[];loading=!1;chatMessagesContainer;IsMember=!1;messageIdCounter=0;apiUrl3="api/chat/quest/";apiUrl="";constructor(t,e){this.formBuilder=t,this.httpMethods=e,this.chatForm=this.formBuilder.group({quest:["",G.required]})}ngOnInit(){this.IsMember?this.apiUrl="api/chat/quest/ask_persona/":this.apiUrl="api/chat/quest/ask_gestor/",this.httpMethods.get(this.apiUrl3).subscribe(t=>{this.messages=t.results.flatMap(e=>[{id:this.messageIdCounter++,text:e.question,time:new Date(e.created_at),isUser:!0,active:e.active,answer:e.answer,created_at:new Date(e.created_at),modified_at:new Date(e.modified_at),question:e.question,usuario:e.usuario},{id:this.messageIdCounter++,text:e.answer,time:new Date(e.created_at),isUser:!1,active:e.active,answer:e.answer,created_at:new Date(e.created_at),modified_at:new Date(e.modified_at),question:e.question,usuario:e.usuario}])})}ngAfterViewChecked(){this.scrollToBottom()}sendMessage(){if(this.chatForm.invalid||this.loading)return;let t=this.chatForm.get("quest")?.value;this.messages.push({id:this.messageIdCounter++,text:t,time:new Date,isUser:!0,active:!0,answer:"",question:t,created_at:new Date,modified_at:new Date}),this.loading=!0;let e={quest:t};this.chatForm.reset(),this.chatForm.get("quest")?.setErrors(null),this.httpMethods.post(this.apiUrl,e).subscribe(a=>{this.loading=!1,this.messages.push({id:this.messageIdCounter++,text:a.result,time:new Date,isUser:!1,active:!0,answer:a.result,question:t,created_at:new Date,modified_at:new Date}),this.scrollToBottom()})}scrollToBottom(){this.chatMessagesContainer&&(this.chatMessagesContainer.nativeElement.scrollTop=this.chatMessagesContainer.nativeElement.scrollHeight)}static \u0275fac=function(e){return new(e||i)(d($),d(ee))};static \u0275cmp=u({type:i,selectors:[["app-chat"]],viewQuery:function(e,a){if(e&1&&b(te,5),e&2){let l;y(l=I())&&(a.chatMessagesContainer=l.first)}},inputs:{IsMember:"IsMember"},standalone:!0,features:[q],decls:18,vars:4,consts:[["chatMessages",""],[1,"chat-container"],["color","primary",1,"chat-toolbar"],[1,"chat-messages"],[1,"message","mt-3",3,"ngClass"],[1,"empty-state"],[1,"grid","justify-content-center","justify-content-start","chat-input",3,"ngSubmit","formGroup"],["appearance","fill",1,"col-8","align-self-center","justify-content-start","align-items-center","align-content-center"],["matInput","","formControlName","quest"],["mat-raised-button","","color","primary","type","submit",1,"align-self-center",3,"disabled"],[1,"message-content"],[1,"message-text"],[1,"message-time"]],template:function(e,a){if(e&1){let l=x();o(0,"main",1)(1,"mat-toolbar",2)(2,"span"),r(3,"Chat com MyGym IA"),n()(),o(4,"div",3,0),C(6,ne,7,9,"div",4,ie),g(8,oe,3,0,"div",5),n(),o(9,"form",6),w("ngSubmit",function(){return f(l),h(a.sendMessage())}),o(10,"mat-form-field",7)(11,"mat-label"),r(12,"Digite sua pergunta"),n(),v(13,"input",8),n(),o(14,"button",9)(15,"mat-icon"),r(16,"send"),n(),r(17),n()()()}e&2&&(s(6),_(a.messages),s(2),M(a.messages.length?-1:8),s(),c("formGroup",a.chatForm),s(5),c("disabled",!a.chatForm.valid||a.loading),s(3),F(" ",a.loading?"Enviando...":"Enviar"," "))},dependencies:[L,z,N,A,Q,H,R,X,W,K,Z,Y,U,T,k,B,j,V,J,O,P],styles:[".chat-container[_ngcontent-%COMP%]{height:100vh;display:flex;flex-direction:column;position:relative;overflow:hidden}.chat-toolbar[_ngcontent-%COMP%]{top:0;left:0;right:0;z-index:10}.chat-messages[_ngcontent-%COMP%]{flex:1;margin-top:64px;margin-bottom:72px;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}.message[_ngcontent-%COMP%]{display:flex;max-width:70%}.user-message[_ngcontent-%COMP%]{justify-content:flex-end;margin-left:auto}.ia-message[_ngcontent-%COMP%]{justify-content:flex-start}.message-content[_ngcontent-%COMP%]{padding:12px 16px;border-radius:12px;background-color:#fff;box-shadow:0 2px 4px #0000001a}.user-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff}.message-text[_ngcontent-%COMP%]{display:block;word-wrap:break-word}.message-time[_ngcontent-%COMP%]{display:block;font-size:.8em;opacity:.7;margin-top:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;color:#666;padding:32px}.chat-input[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0}"]})}return i})();export{be as a};
