import{B as g,a as m,z as k}from"./chunk-3RHGMBTT.js";import{a as l,b as f}from"./chunk-H2QP3XJO.js";import{B as n,R as o,U as s,Y as u,ba as h,l as c,m as d}from"./chunk-KGKDVHTP.js";var x=(()=>{class a{http;snackBar;authService;baseUrl=m.baseUrl;constructor(e,t,r){this.http=e,this.snackBar=t,this.authService=r}getHeaders(){let e=this.authService.getToken()||"";return this.isTokenExpired()?this.authService.refreshToken().pipe(o(t=>c(new l({Authorization:"Bearer ".concat(t)})))):c(new l({Authorization:"Bearer ".concat(e)}))}handleError(e){let t="Ocorreu um erro inesperado.";if(e&&e.error){if(e.error.detail&&e.error.detail.length>0)t=`Erro: ${e.error.detail}`;else if(e.error.username&&e.error.username.length>0)t=`Erro no email: ${e.error.username}`;else for(let r in e.error)if(e.error.hasOwnProperty(r)&&e.error[r].length>0){t=`${e.error[r]}`;break}}else e.status&&(t=e.error);return this.snackBar.open(t,"Fechar",{duration:5e3,verticalPosition:"top"}),d(t)}isTokenExpired(){let e=this.authService.getToken();if(!e)return console.warn("Token n\xE3o encontrado."),!0;try{let t=this.decodedToken(e);return new Date(t.exp*1e3)<new Date}catch{return!0}}decodedToken(e){try{let t=e.split(".")[1];return JSON.parse(atob(t))}catch{throw new Error("Token inv\xE1lido.")}}post(e,t){return this.getHeaders().pipe(o(r=>this.http.post(this.baseUrl+e,t,{headers:r}).pipe(n(i=>this.handleError(i)))))}get(e){return this.getHeaders().pipe(o(t=>this.http.get(this.baseUrl+e,{headers:t}).pipe(n(r=>this.handleError(r)))))}patch(e,t){return this.getHeaders().pipe(o(r=>this.http.patch(this.baseUrl+e+t.id+"/",t,{headers:r}).pipe(s(i=>i),n(i=>this.handleError(i)))))}delete(e,t){return this.getHeaders().pipe(o(r=>this.http.delete(this.baseUrl+e+t+"/",{headers:r}).pipe(s(i=>i),n(i=>this.handleError(i)))))}disable(e,t,r){return this.getHeaders().pipe(o(i=>this.http.post(this.baseUrl+e+t.id+`/${r}/`,t,{headers:i}).pipe(s(p=>p),n(p=>this.handleError(p)))))}static \u0275fac=function(t){return new(t||a)(h(f),h(k),h(g))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();export{x as a};
