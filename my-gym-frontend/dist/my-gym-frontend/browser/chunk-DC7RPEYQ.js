import{a as Ce}from"./chunk-CQ5V4TRC.js";import{c as Me}from"./chunk-MMD3N6TB.js";import{a as ye,b as Pe}from"./chunk-FBCDN2KP.js";import{a as ve}from"./chunk-YT7YNDF5.js";import{a as E}from"./chunk-ED4W6NZD.js";import{a as U}from"./chunk-AWHMWCAF.js";import{b as N,c as xe,g as A,j as V,l as x}from"./chunk-ACH2ET7Q.js";import{B as he,E as ge,H as be,I as L,J as _e,Z as S,a as P,q as G,s as _,u as R,v as pe,x as ue,y as fe}from"./chunk-DYA4TUSH.js";import"./chunk-CARY4E7O.js";import{a as $,c as z}from"./chunk-LKV62IVN.js";import{j as de,l as y,p as ce}from"./chunk-MNF6TJHE.js";import{$ as te,$b as ae,$c as se,Ab as F,Bb as n,Cb as r,Db as b,E as ee,Hb as j,Kb as p,Mb as M,Xa as l,Xb as re,Ya as c,Yb as a,Zb as f,Zc as me,_b as h,ac as O,bc as B,cc as D,ec as C,f as X,ia as v,ic as oe,ja as ie,jc as le,m as Y,nb as T,q as Z,qa as I,ra as w,sb as u,xb as g,yb as ne,zb as k}from"./chunk-BE5RT4AU.js";import"./chunk-JKOY2XUY.js";var je=(o,d)=>d.id;function Oe(o,d){if(o&1&&(n(0,"li",13),a(1),r()),o&2){let e=d.$implicit;l(),h(" ",e,"")}}function Be(o,d){if(o&1){let e=j();n(0,"mat-card",2)(1,"mat-card-content",5)(2,"div",6)(3,"div",7)(4,"div",8),a(5),r(),n(6,"div",9),a(7),r()(),n(8,"div",10),a(9),r(),n(10,"div",11),a(11,"Benef\xEDcios:"),r(),n(12,"ul",12),k(13,Oe,2,1,"li",13,ne),r(),n(15,"mat-card",14)(16,"div",15)(17,"div"),a(18,"Dura\xE7\xE3o:"),r(),n(19,"div",16),a(20),r()(),n(21,"div",15)(22,"div"),a(23,"Dias dispon\xEDveis:"),r(),n(24,"div",13),a(25),r()()()()(),n(26,"button",17),p("click",function(){let t=I(e).$implicit,m=M();return w(m.editPlan(t))}),n(27,"mat-icon"),a(28,"check_circle"),r(),a(29," Selecionar Plano "),r()()}if(o&2){let e=d.$implicit;l(5),f(e.nome),l(2),h("R$ ",e.preco,""),l(2),h(" ",e.descricao," "),l(4),F(e.beneficios),l(7),h("",e.duracao," meses"),l(5),h(" ",e.dias_permitidos_str,"")}}var we=(()=>{class o{httpMethods;router;snackBar;member;pathUrlPlan=x.PLAN;pathUrlPlanMember=x.MEMBERPLAN;plans;gym_id="";typeUser="";limit=6;currentPage=0;totalResults=0;constructor(e,i,t){this.httpMethods=e,this.router=i,this.snackBar=t}ngOnInit(){this.getIdGym(),this.search(),this.getTypeUser()}getIdGym(){this.gym_id=localStorage.getItem("academia")}getTypeUser(){this.typeUser=localStorage.getItem("usuario_tipo")}search(e=0,i=this.limit){let t={academia:this.gym_id,active:!0,limit:i,offset:e};this.httpMethods.getPaginated(this.pathUrlPlan,t).subscribe(m=>{m.results.length<=0&&this.snackBar.open("N\xE3o h\xE1 planos ativos cadastrados!","fechar",{duration:2e3,verticalPosition:"top"}),this.plans=m.results,this.totalResults=m.count,this.currentPage=e/i})}nextPage(){let e=Math.ceil(this.totalResults/this.limit)-1;if(this.currentPage<e){let i=(this.currentPage+1)*this.limit;this.search(i)}}prevPage(){if(this.currentPage>0){let e=(this.currentPage-1)*this.limit;this.search(e)}}editPlan(e){let i={aluno:this.member?.id,plano:e.id,academia:e.academia};this.httpMethods.post(this.pathUrlPlanMember+"alterar_plano/",i).subscribe(()=>{this.snackBar.open("Aluno vinculado a plano","Fechar",{duration:5e3,verticalPosition:"top"}),this.router.navigate(["/member/list/"])})}static \u0275fac=function(i){return new(i||o)(c(E),c(y),c(S))};static \u0275cmp=v({type:o,selectors:[["app-member-plan"]],inputs:{member:"member"},standalone:!0,features:[C],decls:12,vars:7,consts:[[1,"Plan-list"],[1,"flex","flex-wrap","justify-content-center","gap-3","p-2","overflow-y-hidden"],[1,"plan-card","w-30rem","p-3","flex","flex-column","justify-content-between"],[1,"pagination","flex","justify-content-center","gap-2","mt-5"],["mat-raised-button","",3,"click","disabled"],[1,"flex-grow-1"],[1,"flex","flex-column","gap-2"],[1,"flex","align-items-center","justify-content-between"],[1,"text-2xl","font-bold"],[1,"text-2xl","font-bold","text-green-500"],[1,"line-clamp-3","text-gray-700","text-sm","mb-2","overflow-hidden","text-overflow-ellipsis","line-clamp-3"],[1,"text-lg","font-bold","overflow-hidden","text-overflow-ellipsis"],[1,"pl-3","line-clamp-5","overflow-hidden"],[1,"text-sm"],["appearance","outlined",1,"p-3","mb-3"],[1,"flex","justify-content-between","text-sm","font-medium"],[1,"text-primary","font-bold"],["mat-stroked-button","",1,"view-details-button","p-2","w-full","align-content-center","justify-content-center",3,"click"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1),k(2,Be,30,5,"mat-card",2,je),r(),n(4,"div",3)(5,"button",4),p("click",function(){return t.prevPage()}),a(6,"Anterior"),r(),n(7,"span"),a(8),oe(9,"number"),r(),n(10,"button",4),p("click",function(){return t.nextPage()}),a(11,"Pr\xF3xima"),r()()()),i&2&&(l(2),F(t.plans),l(3),u("disabled",t.currentPage===0),l(3),ae("P\xE1gina ",t.currentPage+1," de ",le(9,4,t.totalResults/t.limit,"1.0-0"),""),l(2),u("disabled",t.currentPage>=t.totalResults/t.limit-1))},dependencies:[z,$,U,P,me],styles:[".plan-card[_ngcontent-%COMP%]{margin-bottom:16px}.plan-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.plan-info[_ngcontent-%COMP%]{flex:1}.plan-description[_ngcontent-%COMP%]{flex:1;margin-left:16px;margin-top:8px;padding:8px;background-color:#f9f9f9;border-radius:4px;font-size:14px;line-height:1.6;color:#555;max-height:100px;overflow-y:auto}"]})}return o})();function Ue(o,d){o&1&&(n(0,"mat-error"),a(1," Campo Obrigatorio "),r())}function Ge(o,d){o&1&&(n(0,"mat-error"),a(1," Nome tem limite de 50 caracteres "),r())}function Re(o,d){o&1&&(n(0,"mat-error"),a(1," Campo Obrigatorio "),r())}function Le(o,d){o&1&&(n(0,"mat-error"),a(1," Insira um email valido "),r())}function Ne(o,d){o&1&&(n(0,"mat-error"),a(1," Campo Obrigatorio "),r())}function Ae(o,d){o&1&&(n(0,"mat-error"),a(1," N\xFAmero de telefone inv\xE1lido "),r())}function Ve(o,d){o&1&&(n(0,"mat-error"),a(1," Campo Obrigatorio "),r())}var Te=(()=>{class o{httpMethods;formBuilder;router;route;snackBar;obj=void 0;action="";plans=[];pathUrlMember=x.MEMBER;pathUrlPlan=x.PLAN;formGroup;created=!0;gymId="";selectedIndex=0;title="Cadastro de aluno";getGym(){this.gymId=localStorage.getItem("academia"),this.gymId&&this.formGroup.patchValue({academia:this.gymId})}constructor(e,i,t,m,s){this.httpMethods=e,this.formBuilder=i,this.router=t,this.route=m,this.snackBar=s,this.formGroup=this.formBuilder.group({id:[],nome:["",[_.required,_.maxLength(50)]],telefone:["",[_.required,_.pattern("[0-9]{10,11}")]],email:["",[_.required,_.email]],data_nascimento:["",_.required],academia:[null],matricula:[]})}ngOnInit(){this.getGym(),this.httpMethods.get(this.pathUrlPlan+`?academia=${this.gymId}&active=true`).subscribe(e=>{this.plans=e}),this.route.paramMap.subscribe(e=>{this.action=e.get("action"),this.created=!(this.action&&this.action!=="create"),this.created||(this.title="Edi\xE7\xE3o de aluno",this.httpMethods.get(this.pathUrlMember+`${this.action}/`).subscribe(i=>{this.obj=i,this.formGroup.setValue({id:i.id,nome:i.nome,email:i.email,telefone:i.telefone,data_nascimento:i.data_nascimento,matricula:i.matricula,academia:this.gymId})}))})}saveOrUpdate(e){this.created?this.httpMethods.get(this.pathUrlMember+`?email=${e.email}`).subscribe(i=>i.results&&i.results.length>0?(this.router.navigate([`/member/form/${i.results[0].id}`]),this.snackBar.open("O usu\xE1rio j\xE1 existe no sistema. Altere apenas seu plano.","Fechar",{duration:5e3,verticalPosition:"top"}),this.selectedIndex=1,Y(null)):this.httpMethods.post(this.pathUrlMember,e).pipe(Z(t=>t)).subscribe(t=>{this.obj=t,this.selectedIndex=1})):this.httpMethods.patch(`${this.pathUrlMember}`,e).subscribe(()=>{this.snackBar.open("Dados do aluno atualizados","O usu\xE1rio",{duration:5e3,verticalPosition:"top"}),this.obj=e})}return(){this.router.navigate(["/member/list/"])}static \u0275fac=function(i){return new(i||o)(c(E),c(be),c(y),c(de),c(S))};static \u0275cmp=v({type:o,selectors:[["app-form"]],standalone:!0,features:[C],decls:36,vars:13,consts:[[3,"selectedIndexChange","selectedIndex"],["label","Dados do Aluno"],[1,"container","p-7"],[1,"mat-elevation-z2","form",3,"ngSubmit","formGroup"],["appearance","fill",1,"nome"],["matInput","","formControlName","nome","placeholder","Digite o nome"],["appearance","fill"],["matInput","","type","email","formControlName","email","placeholder","Digite o Email"],["matInput","","type","cellphone","formControlName","telefone","placeholder","Digite o Telefone"],["matInput","","type","date","formControlName","data_nascimento","placeholder","digite a data de nascimento"],["mat-raised-button","","color","primary","type","submit",1,"save",3,"disabled"],["label","Sele\xE7\xE3o de Plano",3,"disabled"],[3,"member"],["mat-raised-button","","color","warn",3,"click"]],template:function(i,t){if(i&1&&(n(0,"h2"),a(1),r(),n(2,"mat-tab-group",0),D("selectedIndexChange",function(s){return B(t.selectedIndex,s)||(t.selectedIndex=s),s}),n(3,"mat-tab",1)(4,"div",2)(5,"form",3),p("ngSubmit",function(){return t.saveOrUpdate(t.formGroup.value)}),n(6,"mat-form-field",4)(7,"mat-label"),a(8,"Nome"),r(),b(9,"input",5),T(10,Ue,2,0,"mat-error")(11,Ge,2,0,"mat-error"),r(),n(12,"mat-form-field",6)(13,"mat-label"),a(14,"Email"),r(),b(15,"input",7),T(16,Re,2,0,"mat-error")(17,Le,2,0,"mat-error"),r(),n(18,"mat-form-field",6)(19,"mat-label"),a(20,"Telefone"),r(),b(21,"input",8),T(22,Ne,2,0,"mat-error")(23,Ae,2,0,"mat-error"),r(),n(24,"mat-form-field",6)(25,"mat-label"),a(26,"Data de nascimento"),r(),b(27,"input",9),T(28,Ve,2,0,"mat-error"),r(),n(29,"button",10),a(30,"Salvar "),r()()()(),n(31,"mat-tab",11),b(32,"app-member-plan",12),r(),n(33,"div")(34,"button",13),p("click",function(){return t.return()}),a(35,"finalizar"),r()()()),i&2){let m,s,H,W,J,K,Q;l(),f(t.title),l(),O("selectedIndex",t.selectedIndex),l(3),u("formGroup",t.formGroup),l(5),g((m=t.formGroup.get("nome"))!=null&&m.hasError("required")?10:-1),l(),g((s=t.formGroup.get("nome"))!=null&&s.hasError("maxlength")?11:-1),l(5),g((H=t.formGroup.get("email"))!=null&&H.hasError("required")?16:-1),l(),g((W=t.formGroup.get("email"))!=null&&W.hasError("email")?17:-1),l(5),g((J=t.formGroup.get("telefone"))!=null&&J.hasError("required")?22:-1),l(),g((K=t.formGroup.get("telefone"))!=null&&K.hasError("pattern")?23:-1),l(5),g((Q=t.formGroup.get("data_nascimento"))!=null&&Q.hasError("required")?28:-1),l(),u("disabled",!t.formGroup.valid),l(2),u("disabled",!t.obj),l(),u("member",t.obj)}},dependencies:[L,fe,G,R,pe,P,A,V,N,_e,he,ge,Pe,ye,we,xe],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.form[_ngcontent-%COMP%]{width:100%;max-width:600px;padding:20px;background-color:#fff;border-radius:8px;box-shadow:0 4px 8px #0000001a}mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}mat-label[_ngcontent-%COMP%]{font-weight:700;color:#333}input[_ngcontent-%COMP%]{font-size:16px;padding:10px}button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:16px;border:none;border-radius:4px;cursor:pointer}mat-tab-group[_ngcontent-%COMP%]{padding-left:1%;width:98%}"]})}return o})();function $e(o,d){return this.trackById}function ze(o,d){if(o&1){let e=j();n(0,"mat-card",10)(1,"mat-card-content")(2,"mat-card",12),a(3),r(),n(4,"div",13)(5,"div",14),a(6),r(),n(7,"div",15)(8,"div",16),a(9),r(),n(10,"div",17),a(11),r()()(),n(12,"div",18)(13,"div",19)(14,"span"),a(15,"Plano Atual:"),r(),n(16,"strong"),a(17),r()(),n(18,"div",19)(19,"span"),a(20,"Matr\xEDcula:"),r(),n(21,"strong"),a(22),r()()()(),n(23,"div",20)(24,"div",21),p("click",function(){let t=I(e).$implicit,m=M();return w(m.edit(t.aluno))}),n(25,"mat-icon"),a(26,"edit"),r(),n(27,"span"),a(28,"Editar"),r()(),n(29,"div",22),p("click",function(){let t=I(e).$implicit,m=M();return w(m.disable(t.aluno))}),n(30,"mat-icon"),a(31,"delete"),r(),n(32,"span"),a(33,"Apagar"),r()()()()}if(o&2){let e=d.$implicit,i=M();l(2),re("color: white ;background-color:",i.getMemberStatusColor(e.data_vencimento),""),l(),h(" ",i.getMemberStatus(e.data_vencimento)," "),l(3),h(" ",i.getInitials(e.aluno.nome)," "),l(3),f(e.aluno.nome),l(2),f(e.aluno.email),l(6),f(e.plano.nome),l(5),f(e.aluno.matricula)}}var ke=(()=>{class o{httpMethods;router;snackBar;dialog;pathUrlMemberPlan=x.MEMBERPLAN;members;gym_id="";typeUser="";searchTerm="";limit=12;totalResults=0;currentPage=0;searchChange=new X;constructor(e,i,t,m){this.httpMethods=e,this.router=i,this.snackBar=t,this.dialog=m}ngOnInit(){this.getIdGym(),this.search(),this.getTypeUser(),this.searchChange.pipe(ee(100)).subscribe(e=>{this.searchMember(e,0)})}getMemberStatus(e){if(!e)return"Indefinido";let i=new Date;i.setHours(0,0,0,0);let t=new Date(e);return t.setHours(0,0,0,0),t.getTime()<i.getTime()?"Inadimplente":t.getTime()===i.getTime()?"Expira Hoje":"Ativo"}getMemberStatusColor(e){if(!e)return"#858585";let i=this.getMemberStatus(e);return{Inadimplente:"#d82d2d","Expira Hoje":"#D8A22DFF",Ativo:"#2dd853",Indefinido:"#858585"}[i]||"#858585"}getIdGym(){this.gym_id=localStorage.getItem("academia")}getTypeUser(){this.typeUser=localStorage.getItem("tipo_usuario")}search(){this.searchMember(this.searchTerm,0)}create(){this.router.navigate(["/member/form/create"]).then()}edit(e){this.router.navigate([`/member/form/${e.id}`]).then()}trackById(e,i){return i.aluno.id}getInitials(e){if(!e)return"";let t=e.trim().split(" ").map(m=>m.charAt(0).toUpperCase()).join("");return t.length>2?t.substring(0,2):t}disable(e){this.dialog.open(Ce).afterClosed().subscribe(t=>{if(t){if(this.gym_id)e.academia=this.gym_id;else{console.error("Gym ID is missing");return}this.httpMethods.disable(this.pathUrlMemberPlan,e,"desativar_aluno").subscribe(()=>{this.searchMember(),this.snackBar.open("Aluno desativado","Fechar",{duration:5e3,verticalPosition:"top"})})}})}searchMember(e="",i=0,t=this.limit){let m={expand:["aluno","plano"],active:!0,academia:this.gym_id,limit:t,offset:i};e&&(m.search=e),this.httpMethods.getPaginated(this.pathUrlMemberPlan,m).subscribe(s=>{this.members=s.results,this.totalResults=s.count,this.currentPage=i/t})}onSearchChange(e){this.searchTerm=e,this.searchChange.next(e)}onPageChange(e){let i=e*this.limit;this.searchMember(this.searchTerm,i)}static \u0275fac=function(i){return new(i||o)(c(E),c(y),c(S),c(Me))};static \u0275cmp=v({type:o,selectors:[["app-list"]],standalone:!0,features:[C],decls:20,vars:4,consts:[[1,"container"],[1,"title"],[1,"subtitle","flex","justify-content-center"],[1,"flex","align-items-center","justify-content-between","w-full","mb-4"],[1,"w-10rem"],["appearance","outline",1,"search","w-30rem"],["matInput","text","placeholder","Digite o nome ou matricula",3,"ngModelChange","input","ngModel"],[1,"align-self-start","mr-2"],["mat-raised-button","","color","primary",1,"add_button","bg-black-alpha-70","mt-2",2,"color","white",3,"click"],[1,"member-list","ml-4"],[1,"member-card"],[3,"pageChange","totalItems","itemsPerPage","currentPage"],[1,"absolute","top-0","right-0","m-2","px-2","py-1","text-sm","shadow-1","rounded"],[1,"member-info","flex","align-items-center"],[1,"avatar","align-items-center"],[1,"flex-column"],[1,"name","font-bold"],[1,"email"],[1,"extra-info"],[1,"info-row"],[1,"footer","p-2","flex","justify-content-between","align-items-center"],[1,"icon-edit","flex","items-center","gap-2",3,"click"],[1,"icon-delete","flex","items-center","gap-2",3,"click"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"h2",1),a(2,"Alunos"),r(),n(3,"p",2),a(4,"Edite ou desative alunos vinculados a academia"),r(),n(5,"div",3),b(6,"div",4),n(7,"mat-form-field",5)(8,"mat-label"),a(9,"Buscar aluno"),r(),n(10,"input",6),D("ngModelChange",function(s){return B(t.searchTerm,s)||(t.searchTerm=s),s}),p("input",function(){return t.onSearchChange(t.searchTerm)}),r()(),n(11,"div",7)(12,"button",8),p("click",function(){return t.create()}),n(13,"mat-icon"),a(14,"add"),r(),a(15," Novo Aluno "),r()()(),n(16,"div",9),k(17,ze,34,9,"mat-card",10,$e,!0),r(),n(19,"app-paginator",11),p("pageChange",function(s){return t.onPageChange(s)}),r()()),i&2&&(l(10),O("ngModel",t.searchTerm),l(7),F(t.members),l(2),u("totalItems",t.totalResults)("itemsPerPage",t.limit)("currentPage",t.currentPage))},dependencies:[$,U,z,N,A,V,L,G,R,ue,P,ve],styles:[".container[_ngcontent-%COMP%]{padding:20px}.subtitle[_ngcontent-%COMP%]{text-align:center;color:#909090}.search[_ngcontent-%COMP%]{margin:auto}.member-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}.member-card[_ngcontent-%COMP%]{width:95%;background:#f8f8f8;border-radius:12px;box-shadow:0 2px 4px #0000001a;transition:all .3s ease-in-out;cursor:pointer}.member-card[_ngcontent-%COMP%]:hover{transform:scale(1.06);box-shadow:0 4px 8px #00000026}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#53cd55;color:#fff;font-weight:700;font-size:16px;display:flex;align-items:center;justify-content:center;border-radius:50%;text-transform:uppercase}.member-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.email[_ngcontent-%COMP%]{font-size:.85rem;color:#666}.extra-info[_ngcontent-%COMP%]{margin-top:10px;padding-top:10px;border-top:1px solid #eee}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.9rem;color:#444}.footer[_ngcontent-%COMP%]{background:#ededed;font-size:.9rem;color:#969696;border-top:1px solid #eee;border-radius:0 0 9px 9px}.icon-edit[_ngcontent-%COMP%]:hover{color:#5a87e6}.icon-delete[_ngcontent-%COMP%]:hover{color:#e65a5a}"]})}return o})();var Fe=[{path:"list",component:ke},{path:"form/:action",component:Te}];var Pt=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=ie({type:o});static \u0275inj=te({imports:[se,ce.forChild(Fe)]})}return o})();export{Pt as MemberModule};
