import{C as g,D as k,G as E}from"./chunk-VL4B4XMJ.js";import{a as d,b as m,c as f}from"./chunk-DYBUUYLF.js";import{$ as u,C as o,U as a,X as h,ea as p,m as c,n as l}from"./chunk-KNMBK3NL.js";var x=(()=>{class s{http;snackBar;authService;baseUrl=g.baseUrl;constructor(e,t,r){this.http=e,this.snackBar=t,this.authService=r}getHeaders(){let e=this.authService.getToken()||"";return this.isTokenExpired()?this.authService.refreshToken().pipe(a(t=>c(new d({Authorization:"Bearer ".concat(t)})))):c(new d({Authorization:"Bearer ".concat(e)}))}handleError(e){let t="Ocorreu um erro inesperado.";if(e&&e.error){if(e.error.detail&&e.error.detail.length>0)t=`Erro: ${e.error.detail}`;else if(e.error.username&&e.error.username.length>0)t=`Erro no email: ${e.error.username}`;else for(let r in e.error)if(e.error.hasOwnProperty(r)&&e.error[r].length>0){t=`${e.error[r]}`;break}}else e.status&&(t=e.error);return this.snackBar.open(t,"Fechar",{duration:5e3,verticalPosition:"top"}),l(t)}isTokenExpired(){let e=this.authService.getToken();if(!e)return console.warn("Token n\xE3o encontrado."),!0;try{let t=this.decodedToken(e);return new Date(t.exp*1e3)<new Date}catch{return!0}}decodedToken(e){try{let t=e.split(".")[1];return JSON.parse(atob(t))}catch{throw new Error("Token inv\xE1lido.")}}post(e,t){return this.getHeaders().pipe(a(r=>this.http.post(this.baseUrl+e,t,{headers:r}).pipe(o(i=>this.handleError(i)))))}get(e){return this.getHeaders().pipe(a(t=>this.http.get(this.baseUrl+e,{headers:t}).pipe(o(r=>this.handleError(r)))))}getPaginated(e,t){return this.getHeaders().pipe(a(r=>{let i=new m({fromObject:t});return this.http.get(this.baseUrl+e,{headers:r,params:i}).pipe(o(n=>this.handleError(n)))}))}patch(e,t){return this.getHeaders().pipe(a(r=>this.http.patch(this.baseUrl+e+t.id+"/",t,{headers:r}).pipe(h(i=>i),o(i=>this.handleError(i)))))}noIdPatch(e,t){return this.getHeaders().pipe(a(r=>this.http.patch(this.baseUrl+e,t,{headers:r}).pipe(h(i=>i),o(i=>this.handleError(i)))))}delete(e,t){return this.getHeaders().pipe(a(r=>this.http.delete(this.baseUrl+e+t+"/",{headers:r}).pipe(h(i=>i),o(i=>this.handleError(i)))))}disable(e,t,r){return this.getHeaders().pipe(a(i=>this.http.post(this.baseUrl+e+t.id+`/${r}/`,t,{headers:i}).pipe(h(n=>n),o(n=>this.handleError(n)))))}static \u0275fac=function(t){return new(t||s)(p(f),p(k),p(E))};static \u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{x as a};
